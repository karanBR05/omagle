<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Ullu Chat - Anonymous Text & Video Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Properties */
        :root {
            /* Ullu Chat Brand Colors */
            --ullu-purple: #8A2BE2;
            --ullu-purple-light: #9D4EDD;
            --ullu-purple-dark: #7B1FA2;
            --ullu-teal: #20C997;
            --ullu-teal-dark: #1AA179;
            --ullu-pink: #FF4081;
            --ullu-pink-dark: #E91E63;
            --ullu-amber: #FFB300;
            --ullu-amber-dark: #FF8F00;
            --ullu-indigo: #4A6BDF;
            --ullu-indigo-dark: #3A56C9;
            
            /* UI Colors */
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-tertiary: #94A3B8;
            --border-light: #475569;
            --border-medium: #64748B;
            --shadow-soft: 0 4px 20px rgba(138, 43, 226, 0.15);
            --shadow-medium: 0 8px 32px rgba(138, 43, 226, 0.25);
            --shadow-strong: 0 12px 48px rgba(138, 43, 226, 0.35);
            --shadow-glow: 0 0 20px rgba(138, 43, 226, 0.5);
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-xxl: 4rem;
            
            /* Typography */
            --font-xs: 0.75rem;
            --font-sm: 0.875rem;
            --font-md: 1rem;
            --font-lg: 1.125rem;
            --font-xl: 1.25rem;
            --font-2xl: 1.5rem;
            --font-3xl: 2rem;
            --font-4xl: 2.5rem;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
            
            /* Container Widths */
            --container-sm: 100%;
            --container-md: 720px;
            --container-lg: 960px;
            --container-xl: 1200px;
            --container-xxl: 1400px;
        }
        
        /* Base Styles */
        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1E1B4B 100%);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        
        /* Improved Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }
        
        p {
            line-height: 1.6;
        }
        
        /* Container System */
        .container {
            width: 100%;
            max-width: var(--container-xxl);
            margin: 0 auto;
            padding: 0 var(--space-md);
        }
        
        @media (max-width: 1200px) {
            .container {
                max-width: var(--container-xl);
            }
        }
        
        @media (max-width: 992px) {
            .container {
                max-width: var(--container-lg);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: var(--container-md);
                padding: 0 var(--space-sm);
            }
        }
        
        @media (max-width: 576px) {
            .container {
                max-width: var(--container-sm);
                padding: 0 var(--space-xs);
            }
        }
        
        /* Header */
        .app-header {
            background: rgba(30, 41, 59, 0.8);
            box-shadow: var(--shadow-soft);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: var(--space-sm) 0;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            text-decoration: none;
        }
        
        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-xl);
            transition: var(--transition-normal);
            box-shadow: var(--shadow-glow);
        }
        
        .logo:hover .logo-icon {
            transform: rotate(15deg);
            background: linear-gradient(135deg, var(--ullu-purple-light), var(--ullu-indigo));
        }
        
        .logo-text {
            font-size: var(--font-xl);
            font-weight: 700;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }
        
        .logo-tagline {
            display: block;
            font-size: var(--font-xs);
            color: var(--text-tertiary);
            font-weight: 500;
            margin-top: 2px;
        }
        
        /* Navigation */
        .nav-links {
            display: flex;
            gap: var(--space-lg);
            align-items: center;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: var(--font-md);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
            position: relative;
        }
        
        .nav-link:hover {
            color: var(--ullu-purple);
            background: rgba(138, 43, 226, 0.1);
        }
        
        .nav-link.active {
            color: var(--ullu-purple);
            font-weight: 600;
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 3px;
            background: var(--ullu-purple);
            border-radius: var(--radius-full);
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            transition: var(--transition-fast);
        }
        
        .mobile-menu-btn:hover {
            background: var(--bg-tertiary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: var(--space-xl) 0;
            min-height: calc(100vh - 140px);
            display: flex;
            align-items: center;
        }
        
        /* Landing Page */
        .landing-page {
            width: 100%;
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hero-section {
            text-align: center;
            margin-bottom: var(--space-xxl);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-title {
            font-size: var(--font-4xl);
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }
        
        .hero-subtitle {
            font-size: var(--font-xl);
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            font-weight: 400;
        }
        
        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-xxl) 0;
        }
        
        .feature-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            text-align: center;
            border: 1px solid var(--border-light);
            transition: var(--transition-normal);
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-medium);
            border-color: var(--ullu-purple);
        }
        
        .feature-icon-wrapper {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-lg);
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            color: white;
        }
        
        .feature-card:nth-child(2) .feature-icon-wrapper {
            background: linear-gradient(135deg, var(--ullu-teal), var(--ullu-amber));
        }
        
        .feature-card:nth-child(3) .feature-icon-wrapper {
            background: linear-gradient(135deg, var(--ullu-pink), var(--ullu-purple));
        }
        
        .feature-title {
            font-size: var(--font-lg);
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }
        
        .feature-description {
            color: var(--text-secondary);
            font-size: var(--font-md);
            flex: 1;
        }
        
        /* Mode Selection */
        .mode-selection {
            max-width: 900px;
            margin: var(--space-xxl) auto;
            text-align: center;
        }
        
        .mode-title {
            font-size: var(--font-3xl);
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }
        
        .mode-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-lg);
            margin-bottom: var(--space-xl);
        }
        
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .mode-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            cursor: pointer;
            transition: var(--transition-normal);
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .mode-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
            border-color: var(--ullu-purple-light);
        }
        
        .mode-card.selected {
            border-color: var(--ullu-purple);
            background: linear-gradient(to bottom right, var(--bg-secondary), rgba(138, 43, 226, 0.1));
            box-shadow: var(--shadow-medium);
        }
        
        .mode-icon {
            width: 96px;
            height: 96px;
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-lg);
            font-size: 3rem;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            color: white;
        }
        
        .video-mode .mode-icon {
            background: linear-gradient(135deg, var(--ullu-teal), var(--ullu-purple));
        }
        
        .mode-card h3 {
            font-size: var(--font-2xl);
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }
        
        .mode-card p {
            color: var(--text-secondary);
            font-size: var(--font-md);
            flex: 1;
        }
        
        /* Start Button */
        .start-action {
            margin-top: var(--space-xl);
        }
        
        .start-button {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            color: white;
            border: none;
            border-radius: var(--radius-xl);
            padding: var(--space-lg) var(--space-xl);
            font-size: var(--font-lg);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            box-shadow: 0 8px 24px rgba(138, 43, 226, 0.4);
            min-height: 64px;
            min-width: 240px;
        }
        
        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(138, 43, 226, 0.6);
            background: linear-gradient(135deg, var(--ullu-purple-light), var(--ullu-indigo));
        }
        
        .start-button:active {
            transform: translateY(0);
        }
        
        .start-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Chat Session */
        .chat-session {
            display: none;
            flex-direction: column;
            height: calc(100vh - 120px);
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Chat Header */
        .chat-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            padding: var(--space-sm) 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .chat-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 72px;
        }
        
        .chat-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-md);
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            font-weight: 500;
            font-size: var(--font-sm);
            min-width: 140px;
            justify-content: center;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-connecting {
            color: var(--ullu-amber);
        }
        
        .status-connecting .status-dot {
            background: var(--ullu-amber);
        }
        
        .status-searching {
            color: var(--ullu-purple);
        }
        
        .status-searching .status-dot {
            background: var(--ullu-purple);
        }
        
        .status-connected {
            color: var(--ullu-teal);
        }
        
        .status-connected .status-dot {
            background: var(--ullu-teal);
        }
        
        .status-disconnected {
            color: var(--ullu-pink);
        }
        
        .status-disconnected .status-dot {
            background: var(--ullu-pink);
        }
        
        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            overflow: hidden;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            margin: var(--space-lg) 0;
            border: 1px solid var(--border-light);
            min-height: 500px;
        }
        
        /* Text Chat */
        .text-chat-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-height: 500px;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            background: linear-gradient(to bottom, var(--bg-primary), var(--bg-secondary));
        }
        
        .message {
            max-width: 70%;
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            animation: messageAppear 0.3s ease-out;
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-outgoing {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            color: white;
            border-bottom-right-radius: var(--radius-sm);
        }
        
        .message-incoming {
            align-self: flex-start;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
            border-bottom-left-radius: var(--radius-sm);
        }
        
        .message-sender {
            font-size: var(--font-xs);
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .message-text {
            word-break: break-word;
            line-height: 1.5;
        }
        
        .message-time {
            font-size: var(--font-xs);
            text-align: right;
            margin-top: var(--space-xs);
            opacity: 0.7;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            align-self: flex-start;
            background: var(--bg-tertiary);
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--text-secondary);
            font-style: italic;
            border: 1px solid var(--border-light);
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dots span {
            width: 6px;
            height: 6px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        
        /* Text Input */
        .text-input-area {
            border-top: 1px solid var(--border-light);
            padding: var(--space-md);
            background: var(--bg-secondary);
            display: flex;
            gap: var(--space-sm);
            align-items: center;
        }
        
        .text-input {
            flex: 1;
            padding: var(--space-md) var(--space-lg);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-xl);
            font-size: var(--font-md);
            background: var(--bg-primary);
            transition: var(--transition-fast);
            min-height: 56px;
            color: var(--text-primary);
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--ullu-purple);
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }
        
        .send-button {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            flex-shrink: 0;
        }
        
        .send-button:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, var(--ullu-purple-light), var(--ullu-indigo));
        }
        
        /* Video Chat */
        .video-chat-container {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
            min-height: 500px;
        }
        
        /* Desktop Layout */
        .desktop-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            padding: var(--space-md);
            width: 100%;
            height: 100%;
        }
        
        .video-wrapper {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: #0F172A;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
            min-height: 300px;
            border: 1px solid var(--border-light);
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #0F172A;
        }
        
        .local-video video {
            transform: scaleX(-1);
        }
        
        .video-label {
            position: absolute;
            top: var(--space-md);
            left: var(--space-md);
            background: rgba(15, 23, 42, 0.8);
            color: white;
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-full);
            font-size: var(--font-sm);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            backdrop-filter: blur(10px);
            z-index: 10;
            border: 1px solid var(--border-light);
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0.9);
            color: white;
            text-align: center;
            padding: var(--space-xl);
            z-index: 5;
        }
        
        .video-placeholder-icon {
            font-size: 4rem;
            margin-bottom: var(--space-md);
            opacity: 0.7;
        }
        
        /* Mobile Layout */
        .mobile-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        .remote-video-mobile {
            flex: 1;
            position: relative;
            background: #0F172A;
            min-height: 300px;
        }
        
        .local-video-mobile {
            position: absolute;
            bottom: var(--space-md);
            right: var(--space-md);
            width: 120px;
            height: 160px;
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 3px solid var(--bg-secondary);
            box-shadow: var(--shadow-medium);
            z-index: 10;
        }
        
        /* Permission Overlay */
        .permission-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-xl);
            text-align: center;
            z-index: 1000;
            border-radius: var(--radius-lg);
        }
        
        .permission-icon {
            font-size: 4rem;
            color: var(--ullu-purple);
            margin-bottom: var(--space-lg);
        }
        
        .permission-content h2 {
            font-size: var(--font-2xl);
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
        }
        
        .permission-content p {
            color: var(--text-secondary);
            margin-bottom: var(--space-xl);
            max-width: 500px;
        }
        
        /* Control Bar */
        .control-bar {
            background: var(--bg-secondary);
            padding: var(--space-md);
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            border-top: 1px solid var(--border-light);
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }
        
        .control-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-fast);
            min-width: 100px;
            min-height: 80px;
            justify-content: center;
            color: var(--text-primary);
        }
        
        .control-button i {
            font-size: var(--font-xl);
        }
        
        .control-button span {
            font-size: var(--font-sm);
            font-weight: 500;
        }
        
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
            border-color: var(--ullu-purple-light);
        }
        
        .control-button.primary {
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-indigo));
            color: white;
            border: none;
        }
        
        .control-button.warning {
            background: linear-gradient(135deg, var(--ullu-amber), var(--ullu-pink));
            color: white;
            border: none;
        }
        
        .control-button.danger {
            background: linear-gradient(135deg, var(--ullu-pink), var(--ullu-pink-dark));
            color: white;
            border: none;
        }
        
        .control-button.active {
            background: linear-gradient(135deg, var(--ullu-teal), var(--ullu-teal-dark));
            color: white;
            border: none;
        }
        
        .control-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* Status Overlay */
        .status-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
            padding: var(--space-xl);
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(138, 43, 226, 0.1);
            border-radius: 50%;
            border-top-color: var(--ullu-purple);
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-lg);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Footer */
        .app-footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-light);
            padding: var(--space-xl) 0;
            margin-top: auto;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-lg);
        }
        
        .footer-links {
            display: flex;
            gap: var(--space-lg);
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: var(--font-sm);
            transition: var(--transition-fast);
        }
        
        .footer-link:hover {
            color: var(--ullu-purple);
        }
        
        .copyright {
            color: var(--text-tertiary);
            font-size: var(--font-sm);
        }
        
        /* Enhanced Features */
        .partner-info {
            background: var(--bg-tertiary);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-left: auto;
        }
        
        .partner-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--ullu-purple), var(--ullu-teal));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .connection-quality {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: var(--space-sm);
        }
        
        .quality-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--ullu-teal);
        }
        
        .quality-dot:nth-child(2) { opacity: 0.7; }
        .quality-dot:nth-child(3) { opacity: 0.5; }
        
        /* Emoji Picker */
        .emoji-picker {
            position: absolute;
            bottom: 80px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-sm);
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            z-index: 1000;
            box-shadow: var(--shadow-medium);
            display: none;
        }
        
        .emoji-picker.active {
            display: grid;
        }
        
        .emoji-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            background: var(--bg-tertiary);
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }
        
        .emoji-btn:hover {
            background: var(--ullu-purple);
            transform: scale(1.1);
        }
        
        .emoji-toggle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            transition: var(--transition-fast);
        }
        
        .emoji-toggle:hover {
            background: var(--ullu-purple);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            :root {
                --font-4xl: 2.25rem;
                --font-3xl: 1.75rem;
            }
            
            .desktop-layout {
                gap: var(--space-sm);
                padding: var(--space-sm);
            }
        }
        
        @media (max-width: 992px) {
            .hero-title {
                font-size: var(--font-3xl);
            }
            
            .hero-subtitle {
                font-size: var(--font-lg);
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
            }
            
            .mode-card {
                padding: var(--space-lg);
            }
            
            .control-button {
                min-width: 90px;
                min-height: 70px;
            }
            
            .emoji-picker {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }
            
            .nav-links {
                position: fixed;
                top: 80px;
                left: 0;
                right: 0;
                background: var(--bg-secondary);
                flex-direction: column;
                padding: var(--space-lg);
                box-shadow: var(--shadow-medium);
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: var(--transition-normal);
                border-radius: 0 0 var(--radius-lg) var(--radius-lg);
                z-index: 999;
            }
            
            .nav-links.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            .nav-link.active::after {
                bottom: -4px;
            }
            
            .hero-section {
                margin-bottom: var(--space-xl);
            }
            
            .features-grid {
                grid-template-columns: 1fr;
                gap: var(--space-md);
                margin: var(--space-xl) 0;
            }
            
            .feature-card {
                padding: var(--space-lg);
            }
            
            .desktop-layout {
                grid-template-columns: 1fr;
            }
            
            .video-wrapper {
                min-height: 250px;
            }
            
            .local-video-mobile {
                width: 100px;
                height: 140px;
            }
            
            .control-bar {
                padding: var(--space-sm);
                gap: var(--space-xs);
            }
            
            .control-button {
                min-width: 80px;
                min-height: 60px;
                padding: var(--space-xs) var(--space-sm);
            }
            
            .control-button i {
                font-size: var(--font-lg);
            }
            
            .control-button span {
                font-size: var(--font-xs);
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
                gap: var(--space-md);
            }
            
            .partner-info {
                display: none;
            }
            
            .emoji-picker {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            :root {
                --font-4xl: 1.875rem;
                --font-3xl: 1.5rem;
                --font-2xl: 1.25rem;
                --font-xl: 1.125rem;
            }
            
            .hero-title {
                font-size: var(--font-2xl);
            }
            
            .hero-subtitle {
                font-size: var(--font-md);
            }
            
            .mode-card {
                padding: var(--space-md);
            }
            
            .mode-icon {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }
            
            .start-button {
                padding: var(--space-md) var(--space-lg);
                min-width: 200px;
                min-height: 56px;
                font-size: var(--font-md);
            }
            
            .message {
                max-width: 85%;
                padding: var(--space-sm);
            }
            
            .text-input {
                padding: var(--space-sm) var(--space-md);
                min-height: 48px;
            }
            
            .send-button {
                width: 48px;
                height: 48px;
            }
            
            .emoji-picker {
                grid-template-columns: repeat(3, 1fr);
                right: 10px;
                left: 10px;
            }
        }
        
        @media (max-width: 400px) {
            .control-button {
                min-width: 70px;
                padding: 8px;
            }
            
            .local-video-mobile {
                width: 80px;
                height: 110px;
                bottom: var(--space-sm);
                right: var(--space-sm);
            }
            
            .mode-card h3 {
                font-size: var(--font-xl);
            }
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-auto {
            margin-top: auto;
        }
        
        .glow {
            box-shadow: 0 0 15px var(--ullu-purple);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="container header-content">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-owl"></i>
                </div>
                <div>
                    <div class="logo-text">Ullu Chat</div>
                    <span class="logo-tagline">Anonymous Smart Chat</span>
                </div>
            </a>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="nav-links" id="navLinks">
                <a href="#" class="nav-link active">Home</a>
                <a href="#" class="nav-link">Features</a>
                <a href="#" class="nav-link">Safety</a>
                <a href="#" class="nav-link">FAQ</a>
                <a href="#" class="nav-link">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Landing Page -->
            <div id="landingPage" class="landing-page">
                <section class="hero-section">
                    <h1 class="hero-title">Connect with Strangers Anonymously</h1>
                    <p class="hero-subtitle">Intelligent matching, complete privacy, and real conversations. No registration, no tracking.</p>
                </section>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon-wrapper">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <h3 class="feature-title">Smart Anonymity</h3>
                        <p class="feature-description">AI-powered privacy protection and intelligent conversation matching.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon-wrapper">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3 class="feature-title">AI Matching</h3>
                        <p class="feature-description">Find like-minded strangers based on conversation style and interests.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon-wrapper">
                            <i class="fas fa-magic"></i>
                        </div>
                        <h3 class="feature-title">Smart Features</h3>
                        <p class="feature-description">Emoji reactions, ice breakers, and mood-based conversation starters.</p>
                    </div>
                </div>

                <div class="mode-selection">
                    <h2 class="mode-title">Choose Your Experience</h2>
                    <p class="mode-subtitle">Select how you want to connect with random people</p>
                    
                    <div class="mode-cards">
                        <button id="textModeButton" class="mode-card text-mode selected">
                            <div class="mode-icon">
                                <i class="fas fa-comment-dots"></i>
                            </div>
                            <h3>Text Chat</h3>
                            <p>Anonymous text conversations with intelligent matching</p>
                        </button>
                        
                        <button id="videoModeButton" class="mode-card video-mode">
                            <div class="mode-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <h3>Video Chat</h3>
                            <p>Face-to-face video calls with privacy filters</p>
                        </button>
                    </div>
                    
                    <div class="start-action">
                        <button id="startChatButton" class="start-button">
                            <i class="fas fa-owl"></i>
                            Start Ullu Chat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Session -->
            <div id="chatSession" class="chat-session">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="container chat-header-content">
                        <div class="chat-info">
                            <a href="#" class="logo" style="font-size: 1rem;">
                                
                                <div>
                                    <div class="logo-text">Ullu Chat</div>
                                    <span class="logo-tagline">Live</span>
                                </div>
                            </a>
                            
                            <div id="statusIndicator" class="status-indicator status-connecting">
                                <div class="status-dot"></div>
                                <span id="statusText">Connecting...</span>
                            </div>
                            
                            <div class="partner-info hidden" id="partnerInfo">
                                <div class="partner-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <div>Stranger</div>
                                    <div class="connection-quality">
                                        <div class="quality-dot"></div>
                                        <div class="quality-dot"></div>
                                        <div class="quality-dot"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button id="endSessionButton" class="control-button danger">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>End Chat</span>
                        </button>
                    </div>
                </div>

                <!-- Chat Area -->
                <div class="chat-area">
                    <!-- Text Chat -->
                    <div id="textChatContainer" class="text-chat-container hidden">
                        <div id="messagesContainer" class="messages-container">
                            <div class="message message-incoming">
                                <div class="message-sender">
                                    <i class="fas fa-user-circle"></i>
                                    Ullu Assistant
                                </div>
                                <div class="message-text">Hello! I'm finding you a perfect chat partner based on your preferences. Ready for an interesting conversation?</div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                        
                        <div id="typingIndicator" class="typing-indicator hidden">
                            <span>Stranger is typing</span>
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                        
                        <div class="text-input-area">
                            <button id="emojiToggle" class="emoji-toggle">
                                <i class="far fa-smile"></i>
                            </button>
                            <input type="text" id="messageInput" class="text-input" placeholder="Type your message...">
                            <button id="sendMessageButton" class="send-button">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <!-- Emoji Picker -->
                        <div id="emojiPicker" class="emoji-picker">
                            <!-- Emojis will be added by JavaScript -->
                        </div>
                    </div>

                    <!-- Video Chat -->
                    <div id="videoChatContainer" class="video-chat-container hidden">
                        <!-- Desktop Layout -->
                        <div id="desktopLayout" class="desktop-layout">
                            <div class="video-wrapper remote-video">
                                <div class="video-label">
                                    <i class="fas fa-user"></i>
                                    <span>Stranger</span>
                                </div>
                                <video id="remoteVideo" autoplay playsinline></video>
                                <div id="remoteVideoOverlay" class="video-overlay">
                                    <i class="fas fa-user-circle video-placeholder-icon"></i>
                                    <p>Finding your perfect match...</p>
                                </div>
                            </div>
                            
                            <div class="video-wrapper local-video">
                                <div class="video-label">
                                    <i class="fas fa-user"></i>
                                    <span>You</span>
                                </div>
                                <video id="localVideo" autoplay playsinline muted></video>
                                <div id="localVideoOverlay" class="video-overlay">
                                    <i class="fas fa-user-circle video-placeholder-icon"></i>
                                    <p>Your video will appear here</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mobile Layout -->
                        <div id="mobileLayout" class="mobile-layout hidden">
                            <div class="remote-video-mobile">
                                <div class="video-label">
                                    <i class="fas fa-user"></i>
                                    <span>Stranger</span>
                                </div>
                                <video id="remoteVideoMobile" autoplay playsinline></video>
                                <div id="remoteVideoMobileOverlay" class="video-overlay">
                                    <i class="fas fa-user-circle video-placeholder-icon"></i>
                                    <p>Connecting...</p>
                                </div>
                            </div>
                            <div class="local-video-mobile">
                                <video id="localVideoMobile" autoplay playsinline muted></video>
                                <div id="localVideoMobileOverlay" class="video-overlay">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Permission Overlay -->
                        <div id="permissionOverlay" class="permission-overlay hidden">
                            <div class="permission-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="permission-content">
                                <h2>Camera & Microphone Access</h2>
                                <p>To start video chat, we need access to your camera and microphone. Your privacy is protected - no recording or storage.</p>
                                <div class="flex-center" style="gap: var(--space-md); margin-top: var(--space-lg);">
                                    <button id="allowPermissionsButton" class="control-button primary">
                                        <i class="fas fa-check"></i>
                                        <span>Allow Access</span>
                                    </button>
                                    <button id="denyPermissionsButton" class="control-button">
                                        <i class="fas fa-times"></i>
                                        <span>Text Only</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Control Bar -->
                <div class="control-bar">
                    <button id="iceBreakerButton" class="control-button">
                        <i class="fas fa-lightbulb"></i>
                        <span>Ice Breaker</span>
                    </button>
                    
                    <button id="nextButton" class="control-button primary">
                        <i class="fas fa-forward"></i>
                        <span>Next Partner</span>
                    </button>
                    
                    <button id="muteButton" class="control-button">
                        <i class="fas fa-volume-up"></i>
                        <span>Mute</span>
                    </button>
                    
                    <button id="videoToggleButton" class="control-button active">
                        <i class="fas fa-video"></i>
                        <span>Camera On</span>
                    </button>
                    
                    <button id="cameraOffButton" class="control-button">
                        <i class="fas fa-eye-slash"></i>
                        <span>Hide Cam</span>
                    </button>
                    
                    <button id="shareButton" class="control-button">
                        <i class="fas fa-share"></i>
                        <span>Share</span>
                    </button>
                    
                    <button id="reportButton" class="control-button warning">
                        <i class="fas fa-flag"></i>
                        <span>Report</span>
                    </button>
                    
                    <button id="settingsButton" class="control-button">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Status Overlay -->
    <div id="statusOverlay" class="status-overlay hidden">
        <div class="loader"></div>
        <h2 id="statusTitle" class="mode-title">Finding Perfect Match</h2>
        <p id="statusDescription" class="mode-subtitle">Using AI to find someone who matches your conversation style...</p>
        <button id="cancelConnectionButton" class="control-button mt-auto">
            <i class="fas fa-times"></i>
            <span>Cancel</span>
        </button>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container footer-content">
            <div class="copyright">
                 2023 Ullu Chat. Anonymous connections, real conversations.
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link">Privacy First</a>
                <a href="#" class="footer-link">Terms</a>
                <a href="#" class="footer-link">Safety</a>
                <a href="#" class="footer-link">Help</a>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Ullu Chat App State
        const appState = {
            currentPage: 'landing',
            chatMode: 'text',
            connectionStatus: 'disconnected',
            isMuted: false,
            isVideoOn: true,
            isCameraOff: false,
            isMobileView: window.innerWidth <= 768,
            mediaStream: null,
            chatMessages: [],
            isTyping: false,
            typingTimeout: null,
            currentPartner: null,
            isMobileMenuOpen: false,
            iceBreakersUsed: 0,
            connectionQuality: 'good',
            emojiPickerOpen: false
        };

        // DOM Elements
        const elements = {
            landingPage: document.getElementById('landingPage'),
            chatSession: document.getElementById('chatSession'),
            statusOverlay: document.getElementById('statusOverlay'),
            
            // Mode selection
            textModeButton: document.getElementById('textModeButton'),
            videoModeButton: document.getElementById('videoModeButton'),
            startChatButton: document.getElementById('startChatButton'),
            
            // Chat containers
            textChatContainer: document.getElementById('textChatContainer'),
            videoChatContainer: document.getElementById('videoChatContainer'),
            desktopLayout: document.getElementById('desktopLayout'),
            mobileLayout: document.getElementById('mobileLayout'),
            
            // Status
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            statusTitle: document.getElementById('statusTitle'),
            statusDescription: document.getElementById('statusDescription'),
            partnerInfo: document.getElementById('partnerInfo'),
            
            // Video elements
            localVideo: document.getElementById('localVideo'),
            remoteVideo: document.getElementById('remoteVideo'),
            localVideoMobile: document.getElementById('localVideoMobile'),
            remoteVideoMobile: document.getElementById('remoteVideoMobile'),
            localVideoOverlay: document.getElementById('localVideoOverlay'),
            remoteVideoOverlay: document.getElementById('remoteVideoOverlay'),
            localVideoMobileOverlay: document.getElementById('localVideoMobileOverlay'),
            remoteVideoMobileOverlay: document.getElementById('remoteVideoMobileOverlay'),
            permissionOverlay: document.getElementById('permissionOverlay'),
            
            // Controls
            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            navLinks: document.getElementById('navLinks'),
            endSessionButton: document.getElementById('endSessionButton'),
            nextButton: document.getElementById('nextButton'),
            muteButton: document.getElementById('muteButton'),
            videoToggleButton: document.getElementById('videoToggleButton'),
            cameraOffButton: document.getElementById('cameraOffButton'),
            iceBreakerButton: document.getElementById('iceBreakerButton'),
            shareButton: document.getElementById('shareButton'),
            reportButton: document.getElementById('reportButton'),
            settingsButton: document.getElementById('settingsButton'),
            cancelConnectionButton: document.getElementById('cancelConnectionButton'),
            allowPermissionsButton: document.getElementById('allowPermissionsButton'),
            denyPermissionsButton: document.getElementById('denyPermissionsButton'),
            
            // Text chat
            messageInput: document.getElementById('messageInput'),
            sendMessageButton: document.getElementById('sendMessageButton'),
            messagesContainer: document.getElementById('messagesContainer'),
            typingIndicator: document.getElementById('typingIndicator'),
            emojiToggle: document.getElementById('emojiToggle'),
            emojiPicker: document.getElementById('emojiPicker')
        };

        // Ice Breakers Library
        const iceBreakers = [
            "What's the most interesting thing you've learned recently?",
            "If you could travel anywhere right now, where would you go?",
            "What's your favorite way to spend a weekend?",
            "What's something that always makes you smile?",
            "What's the best book/movie you've experienced lately?",
            "If you could have any superpower, what would it be?",
            "What's your go-to comfort food?",
            "What's the most beautiful place you've ever seen?"
        ];

        // Emoji Library
        const emojis = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];

        // Initialize App
        function initApp() {
            setupEventListeners();
            checkViewport();
            setupSampleMessages();
            populateEmojiPicker();
            updateUI();
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Mobile menu
            elements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            
            // Mode selection
            elements.textModeButton.addEventListener('click', () => selectChatMode('text'));
            elements.videoModeButton.addEventListener('click', () => selectChatMode('video'));
            elements.startChatButton.addEventListener('click', startChat);
            
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    if (appState.isMobileView) {
                        elements.navLinks.classList.remove('active');
                        appState.isMobileMenuOpen = false;
                    }
                });
            });
            
            // Chat controls
            elements.endSessionButton.addEventListener('click', endChat);
            elements.nextButton.addEventListener('click', findNextPartner);
            elements.muteButton.addEventListener('click', toggleMute);
            elements.videoToggleButton.addEventListener('click', toggleVideo);
            elements.cameraOffButton.addEventListener('click', toggleCamera);
            elements.iceBreakerButton.addEventListener('click', sendIceBreaker);
            elements.shareButton.addEventListener('click', shareChat);
            elements.reportButton.addEventListener('click', reportUser);
            elements.settingsButton.addEventListener('click', openSettings);
            elements.cancelConnectionButton.addEventListener('click', cancelConnection);
            
            // Permission buttons
            elements.allowPermissionsButton.addEventListener('click', requestMediaPermissions);
            elements.denyPermissionsButton.addEventListener('click', () => {
                elements.permissionOverlay.classList.add('hidden');
                showNotification('Switching to text chat mode', 'info');
                selectChatMode('text');
                startChat();
            });
            
            // Text chat
            elements.sendMessageButton.addEventListener('click', sendMessage);
            elements.messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            elements.messageInput.addEventListener('input', handleTyping);
            elements.emojiToggle.addEventListener('click', toggleEmojiPicker);
            
            // Window events
            window.addEventListener('resize', handleResize);
            window.addEventListener('click', (e) => {
                if (appState.isMobileMenuOpen && !e.target.closest('.mobile-menu-btn') && !e.target.closest('.nav-links')) {
                    elements.navLinks.classList.remove('active');
                    appState.isMobileMenuOpen = false;
                }
                
                if (appState.emojiPickerOpen && !e.target.closest('.emoji-toggle') && !e.target.closest('.emoji-picker')) {
                    elements.emojiPicker.classList.remove('active');
                    appState.emojiPickerOpen = false;
                }
            });
            
            document.addEventListener('submit', (e) => e.preventDefault());
        }

        // Populate Emoji Picker
        function populateEmojiPicker() {
            elements.emojiPicker.innerHTML = '';
            emojis.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'emoji-btn';
                btn.textContent = emoji;
                btn.addEventListener('click', () => {
                    elements.messageInput.value += emoji;
                    elements.messageInput.focus();
                });
                elements.emojiPicker.appendChild(btn);
            });
        }

        // Toggle Mobile Menu
        function toggleMobileMenu() {
            appState.isMobileMenuOpen = !appState.isMobileMenuOpen;
            elements.navLinks.classList.toggle('active', appState.isMobileMenuOpen);
        }

        // Toggle Emoji Picker
        function toggleEmojiPicker() {
            appState.emojiPickerOpen = !appState.emojiPickerOpen;
            elements.emojiPicker.classList.toggle('active', appState.emojiPickerOpen);
        }

        // Handle Resize
        function handleResize() {
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile !== appState.isMobileView) {
                appState.isMobileView = isMobile;
                
                if (appState.chatMode === 'video' && appState.currentPage === 'chat') {
                    updateVideoLayout();
                }
            }
            
            if (!isMobile && appState.isMobileMenuOpen) {
                elements.navLinks.classList.remove('active');
                appState.isMobileMenuOpen = false;
            }
            
            if (appState.emojiPickerOpen) {
                elements.emojiPicker.classList.remove('active');
                appState.emojiPickerOpen = false;
            }
        }

        // Check Viewport
        function checkViewport() {
            appState.isMobileView = window.innerWidth <= 768;
        }

        // Setup Sample Messages
        function setupSampleMessages() {
            const sampleMessages = [
                { sender: 'Ullu Assistant', text: 'Welcome to Ullu Chat! I use smart AI to find you interesting partners.', type: 'incoming', time: 'Just now' }
            ];
            
            sampleMessages.forEach(msg => {
                appState.chatMessages.push(msg);
            });
        }

        // Select Chat Mode
        function selectChatMode(mode) {
            appState.chatMode = mode;
            
            elements.textModeButton.classList.toggle('selected', mode === 'text');
            elements.videoModeButton.classList.toggle('selected', mode === 'video');
            
            elements.startChatButton.innerHTML = `
                <i class="fas fa-${mode === 'text' ? 'comments' : 'video'}"></i>
                Start ${mode === 'text' ? 'Text' : 'Video'} Chat
            `;
        }

        // Start Chat
        async function startChat() {
            appState.currentPage = 'chat';
            elements.landingPage.style.display = 'none';
            elements.chatSession.style.display = 'flex';
            
            if (appState.chatMode === 'text') {
                elements.textChatContainer.classList.remove('hidden');
                elements.videoChatContainer.classList.add('hidden');
                startConnection();
            } else {
                elements.textChatContainer.classList.add('hidden');
                elements.videoChatContainer.classList.remove('hidden');
                updateVideoLayout();
                elements.permissionOverlay.classList.remove('hidden');
            }
        }

        // Request Media Permissions
        async function requestMediaPermissions() {
            elements.permissionOverlay.classList.add('hidden');
            elements.statusOverlay.classList.remove('hidden');
            updateConnectionStatus('connecting');
            
            try {
                const constraints = {
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                appState.mediaStream = stream;
                
                setupLocalVideo(stream);
                startConnection();
                
            } catch (error) {
                console.error('Media access error:', error);
                elements.statusOverlay.classList.add('hidden');
                
                let message = 'Unable to access camera/microphone. ';
                if (error.name === 'NotAllowedError') {
                    message += 'Permission was denied.';
                } else if (error.name === 'NotFoundError') {
                    message += 'No camera/microphone found.';
                } else {
                    message += error.message;
                }
                
                showNotification(message, 'error');
                selectChatMode('text');
                startChat();
            }
        }

        // Setup Local Video
        function setupLocalVideo(stream) {
            if (appState.isMobileView) {
                elements.localVideoMobile.srcObject = stream;
                elements.localVideoMobileOverlay.classList.add('hidden');
            } else {
                elements.localVideo.srcObject = stream;
                elements.localVideoOverlay.classList.add('hidden');
            }
        }

        // Setup Remote Video
        function setupRemoteVideo() {
            setTimeout(() => {
                if (appState.isMobileView) {
                    elements.remoteVideoMobileOverlay.classList.add('hidden');
                } else {
                    elements.remoteVideoOverlay.classList.add('hidden');
                }
                
                if (appState.chatMode === 'text') {
                    simulateIncomingMessage("Hi there! I'm excited to chat with you. How's your day going?");
                }
            }, 2000);
        }

        // Start Connection
        function startConnection() {
            updateConnectionStatus('connecting');
            
            setTimeout(() => {
                updateConnectionStatus('searching');
                
                setTimeout(() => {
                    updateConnectionStatus('connected');
                    
                    if (appState.chatMode === 'video') {
                        setupRemoteVideo();
                    }
                    
                    setTimeout(() => {
                        elements.statusOverlay.classList.add('hidden');
                        
                        if (appState.chatMode === 'text') {
                            simulateIncomingMessage("Hey! I found you through Ullu's smart matching. What would you like to talk about?");
                        }
                        
                        elements.partnerInfo.classList.remove('hidden');
                    }, 1500);
                }, 2500);
            }, 1500);
        }

        // Update Connection Status
        function updateConnectionStatus(status) {
            appState.connectionStatus = status;
            
            const statusConfig = {
                connecting: { text: 'Connecting...', title: 'Connecting to Ullu Network', desc: 'Establishing secure connection...' },
                searching: { text: 'Matching...', title: 'Finding Perfect Partner', desc: 'Using AI to find someone interesting...' },
                connected: { text: 'Connected', title: 'Connected!', desc: 'You are now chatting with a matched stranger.' },
                disconnected: { text: 'Disconnected', title: 'Disconnected', desc: 'Chat session ended.' }
            };
            
            const config = statusConfig[status];
            
            elements.statusIndicator.className = `status-indicator status-${status}`;
            elements.statusText.textContent = config.text;
            elements.statusTitle.textContent = config.title;
            elements.statusDescription.textContent = config.desc;
            
            const isConnected = status === 'connected';
            updateControlStates(isConnected);
        }

        // Update Control States
        function updateControlStates(isConnected) {
            const controls = [
                elements.nextButton,
                elements.muteButton,
                elements.videoToggleButton,
                elements.cameraOffButton,
                elements.iceBreakerButton,
                elements.shareButton,
                elements.reportButton,
                elements.messageInput,
                elements.sendMessageButton
            ];
            
            controls.forEach(control => {
                if (control) {
                    const isVideoControl = control === elements.muteButton || 
                                         control === elements.videoToggleButton || 
                                         control === elements.cameraOffButton;
                    
                    if (isVideoControl) {
                        const disabled = !isConnected || appState.chatMode === 'text';
                        control.disabled = disabled;
                        control.classList.toggle('disabled', disabled);
                    } else if (control !== elements.messageInput && control !== elements.sendMessageButton) {
                        control.disabled = !isConnected;
                        control.classList.toggle('disabled', !isConnected);
                    } else {
                        control.disabled = !isConnected;
                    }
                }
            });
        }

        // Update Video Layout
        function updateVideoLayout() {
            if (appState.isMobileView) {
                elements.desktopLayout.classList.add('hidden');
                elements.mobileLayout.classList.remove('hidden');
            } else {
                elements.desktopLayout.classList.remove('hidden');
                elements.mobileLayout.classList.add('hidden');
            }
        }

        // End Chat
        function endChat() {
            updateConnectionStatus('disconnected');
            
            if (appState.mediaStream) {
                appState.mediaStream.getTracks().forEach(track => track.stop());
                appState.mediaStream = null;
            }
            
            [elements.localVideo, elements.remoteVideo, elements.localVideoMobile, elements.remoteVideoMobile].forEach(video => {
                video.srcObject = null;
            });
            
            elements.statusOverlay.classList.remove('hidden');
            
            setTimeout(() => {
                appState.currentPage = 'landing';
                elements.landingPage.style.display = 'block';
                elements.chatSession.style.display = 'none';
                elements.statusOverlay.classList.add('hidden');
                clearMessages();
                appState.iceBreakersUsed = 0;
                elements.partnerInfo.classList.add('hidden');
            }, 1500);
        }

        // Find Next Partner
        function findNextPartner() {
            updateConnectionStatus('searching');
            elements.statusOverlay.classList.remove('hidden');
            elements.partnerInfo.classList.add('hidden');
            
            if (appState.chatMode === 'text') {
                clearMessages();
                addMessage('Ullu Assistant', 'Finding you a new interesting partner...', 'incoming');
            }
            
            if (appState.chatMode === 'video') {
                if (appState.isMobileView) {
                    elements.remoteVideoMobileOverlay.classList.remove('hidden');
                } else {
                    elements.remoteVideoOverlay.classList.remove('hidden');
                }
            }
            
            setTimeout(() => {
                updateConnectionStatus('connected');
                
                if (appState.chatMode === 'video') {
                    setupRemoteVideo();
                }
                
                setTimeout(() => {
                    elements.statusOverlay.classList.add('hidden');
                    elements.partnerInfo.classList.remove('hidden');
                    
                    if (appState.chatMode === 'text') {
                        simulateIncomingMessage("Hello! I'm your new chat partner from Ullu matching. What's on your mind?");
                    }
                }, 1500);
            }, 3000);
        }

        // Toggle Mute
        function toggleMute() {
            appState.isMuted = !appState.isMuted;
            
            elements.muteButton.innerHTML = appState.isMuted ? 
                `<i class="fas fa-volume-mute"></i><span>Unmute</span>` : 
                `<i class="fas fa-volume-up"></i><span>Mute</span>`;
            
            elements.muteButton.classList.toggle('warning', appState.isMuted);
            
            if (appState.mediaStream) {
                appState.mediaStream.getAudioTracks().forEach(track => {
                    track.enabled = !appState.isMuted;
                });
            }
            
            showNotification(appState.isMuted ? 'Microphone muted' : 'Microphone unmuted', 'info');
        }

        // Toggle Video
        function toggleVideo() {
            appState.isVideoOn = !appState.isVideoOn;
            
            elements.videoToggleButton.classList.toggle('active', appState.isVideoOn);
            elements.videoToggleButton.innerHTML = appState.isVideoOn ? 
                `<i class="fas fa-video"></i><span>Camera On</span>` : 
                `<i class="fas fa-video-slash"></i><span>Camera Off</span>`;
            
            if (appState.mediaStream) {
                appState.mediaStream.getVideoTracks().forEach(track => {
                    track.enabled = appState.isVideoOn;
                });
            }
            
            if (appState.isMobileView) {
                elements.localVideoMobileOverlay.classList.toggle('hidden', appState.isVideoOn);
            } else {
                elements.localVideoOverlay.classList.toggle('hidden', appState.isVideoOn);
            }
            
            showNotification(appState.isVideoOn ? 'Camera turned on' : 'Camera turned off', 'info');
        }

        // Toggle Camera (Hide/Show)
        function toggleCamera() {
            appState.isCameraOff = !appState.isCameraOff;
            
            elements.cameraOffButton.innerHTML = appState.isCameraOff ? 
                `<i class="fas fa-eye"></i><span>Show Cam</span>` : 
                `<i class="fas fa-eye-slash"></i><span>Hide Cam</span>`;
            
            if (appState.mediaStream && appState.chatMode === 'video') {
                if (appState.isCameraOff) {
                    // Apply blur effect to video
                    const videoElement = appState.isMobileView ? elements.localVideoMobile : elements.localVideo;
                    videoElement.style.filter = 'blur(20px) brightness(0.5)';
                } else {
                    // Remove blur effect
                    const videoElement = appState.isMobileView ? elements.localVideoMobile : elements.localVideo;
                    videoElement.style.filter = 'none';
                }
            }
            
            showNotification(appState.isCameraOff ? 'Camera hidden from partner' : 'Camera visible to partner', 'info');
        }

        // Send Ice Breaker
        function sendIceBreaker() {
            if (appState.iceBreakersUsed >= 3) {
                showNotification('Ice breaker limit reached for this session', 'warning');
                return;
            }
            
            const iceBreaker = iceBreakers[Math.floor(Math.random() * iceBreakers.length)];
            sendMessage(iceBreaker);
            appState.iceBreakersUsed++;
            
            // Disable after 3 uses
            if (appState.iceBreakersUsed >= 3) {
                elements.iceBreakerButton.disabled = true;
                elements.iceBreakerButton.classList.add('disabled');
                elements.iceBreakerButton.innerHTML = `<i class="fas fa-lightbulb"></i><span>Limit Reached</span>`;
            }
        }

        // Share Chat
        function shareChat() {
            if (navigator.share) {
                navigator.share({
                    title: 'Ullu Chat - Anonymous Chat',
                    text: 'I\'m having an interesting anonymous chat on Ullu Chat!',
                    url: window.location.href
                });
            } else {
                showNotification('Copy the link to share: ' + window.location.href, 'info');
                navigator.clipboard.writeText(window.location.href);
            }
        }

        // Report User
        function reportUser() {
            const reasons = ['Inappropriate content', 'Harassment', 'Spam', 'Other'];
            const reason = prompt('Select reason:\n\n' + reasons.map((r, i) => `${i + 1}. ${r}`).join('\n'));
            
            if (reason !== null && (reason >= 1 && reason <= 4 || reasons.includes(reason))) {
                showNotification('User reported. Finding new partner...', 'success');
                setTimeout(findNextPartner, 1000);
            }
        }

        // Open Settings
        function openSettings() {
            const settings = [
                ` Device: ${appState.isMobileView ? 'Mobile' : 'Desktop'}`,
                ` Camera: ${appState.isVideoOn ? 'On' : 'Off'} ${appState.isCameraOff ? '(Hidden)' : ''}`,
                ` Microphone: ${appState.isMuted ? 'Muted' : 'Unmuted'}`,
                ` Connection: ${appState.connectionStatus}`,
                ` Mode: ${appState.chatMode}`,
                ` Ice Breakers: ${3 - appState.iceBreakersUsed} remaining`,
                ` Quality: ${appState.connectionQuality}`
            ].join('\n');
            
            alert('Current Settings:\n\n' + settings);
        }

        // Cancel Connection
        function cancelConnection() {
            appState.currentPage = 'landing';
            elements.landingPage.style.display = 'block';
            elements.chatSession.style.display = 'none';
            elements.statusOverlay.classList.add('hidden');
            updateConnectionStatus('disconnected');
            elements.partnerInfo.classList.add('hidden');
            
            if (appState.mediaStream) {
                appState.mediaStream.getTracks().forEach(track => track.stop());
                appState.mediaStream = null;
            }
        }

        // Send Message
        function sendMessage(customText = null) {
            const text = customText || elements.messageInput.value.trim();
            if (!text) return;
            
            addMessage('You', text, 'outgoing');
            
            if (!customText) {
                elements.messageInput.value = '';
                clearTypingIndicator();
            }
            
            setTimeout(() => {
                const replies = [
                    "That's interesting! Tell me more about that.",
                    "I've never thought about it that way before.",
                    "That's cool! What made you think of that?",
                    "I feel the same way about that topic.",
                    "Thanks for sharing that perspective!",
                    "That's a really good point you made.",
                    "I'm curious to know more about your thoughts on that.",
                    "That reminds me of something similar I experienced."
                ];
                
                const reply = replies[Math.floor(Math.random() * replies.length)];
                simulateIncomingMessage(reply);
            }, 1500 + Math.random() * 2000);
        }

        // Handle Typing
        function handleTyping() {
            if (!appState.isTyping) {
                appState.isTyping = true;
                elements.typingIndicator.classList.remove('hidden');
            }
            
            clearTimeout(appState.typingTimeout);
            appState.typingTimeout = setTimeout(() => {
                elements.typingIndicator.classList.add('hidden');
                appState.isTyping = false;
            }, 1000);
        }

        // Clear Typing Indicator
        function clearTypingIndicator() {
            elements.typingIndicator.classList.add('hidden');
            appState.isTyping = false;
            if (appState.typingTimeout) {
                clearTimeout(appState.typingTimeout);
                appState.typingTimeout = null;
            }
        }

        // Simulate Incoming Message
        function simulateIncomingMessage(text) {
            elements.typingIndicator.classList.remove('hidden');
            
            setTimeout(() => {
                elements.typingIndicator.classList.add('hidden');
                addMessage('Stranger', text, 'incoming');
            }, 1000 + Math.random() * 1500);
        }

        // Add Message
        function addMessage(sender, text, type) {
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const message = document.createElement('div');
            message.className = `message message-${type}`;
            message.innerHTML = `
                <div class="message-sender">
                    <i class="fas fa-${type === 'outgoing' ? 'user' : 'user-circle'}"></i>
                    ${sender}
                </div>
                <div class="message-text">${text}</div>
                <div class="message-time">${time}</div>
            `;
            
            elements.messagesContainer.appendChild(message);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
            
            appState.chatMessages.push({ sender, text, type, time });
        }

        // Clear Messages
        function clearMessages() {
            elements.messagesContainer.innerHTML = '';
            appState.chatMessages = [];
            elements.typingIndicator.classList.add('hidden');
            
            // Add welcome message back
            addMessage('Ullu Assistant', 'Finding you a new chat partner...', 'incoming');
        }

        // Update UI
        function updateUI() {
            if (appState.chatMode === 'video' && appState.currentPage === 'chat') {
                updateVideoLayout();
            }
        }

        // Show Notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: '#20C997',
                error: '#FF4081',
                warning: '#FFB300',
                info: '#8A2BE2'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-medium);
                z-index: 3000;
                animation: slideIn 0.3s ease-out;
                max-width: 300px;
                word-break: break-word;
                font-weight: 500;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>